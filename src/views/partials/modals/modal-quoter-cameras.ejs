<div id="quotationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <!-- Header -->
            <div class="text-center mb-2">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Cotización de Sistema de Cámaras</h2>
                <button onclick="closeQuotationModal()"
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Precio Principal -->
            <div class="text-center bg-blue-50 p-6 rounded-lg mb-6">
                <div class="text-4xl font-bold text-blue-600 mb-2" id="totalPrice">
                    $38,164.39 MXM
                </div>
                <p class="text-gray-600">Precio total del sistema</p>
            </div>

            <!-- Especificaciones Técnicas -->
            <div class="grid md:grid-cols-2 gap-4 mb-2">
                <div class="bg-white border rounded-lg p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="hard-drive" class="w-5 h-5 text-blue-500"></i>
                        <h3 class="text-lg font-semibold">Almacenamiento</h3>
                    </div>
                    <div class="text-2xl font-bold text-green-600 mb-1" id="hardDriveSize">4TB</div>
                    <p class="text-sm text-gray-600">
                        Disco duro de alta capacidad para <span id="modalRecordingDays">22</span> días de grabación
                        continua
                    </p>
                </div>

                <div class="bg-white border rounded-lg p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 text-purple-500"></i>
                        <h3 class="text-lg font-semibold">Especificaciones</h3>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Resolución:</span>
                            <span class="font-medium" id="modalResolution">8MP</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Cámaras:</span>
                            <span class="font-medium"><span id="modalQuantity">16</span> unidades</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Tipo:</span>
                            <span class="font-medium" id="modalLocation">Exterior</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen del Proyecto -->
            <div class="bg-white border rounded-lg p-4 mb-2">
                <div class="flex items-center gap-2 mb-3">
                    <i data-lucide="camera" class="w-5 h-5 text-orange-500"></i>
                    <h3 class="text-lg font-semibold">Resumen del Proyecto</h3>
                </div>
                <p class="text-gray-700 leading-relaxed mb-4" id="projectSummary">
                    Sistema de videovigilancia profesional con <strong><span id="summaryQuantityText">16</span> cámaras
                        de <span id="summaryResolutionText">8MP</span></strong>
                    para instalación en <strong id="summaryLocationText">exterior</strong>. Incluye cableado
                    para distancias de <strong id="summaryDistanceText">11-20mts</strong> e instalación a altura de
                    <strong id="summaryHeightText">3-4mts</strong>.
                </p>

                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <i data-lucide="map-pin" class="w-4 h-4 text-gray-500"></i>
                        <span>Instalación <span id="installationType">Exterior</span></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="ruler" class="w-4 h-4 text-gray-500"></i>
                        <span>Cableado <span id="cableDistance">11-20mts</span></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="calendar" class="w-4 h-4 text-gray-500"></i>
                        <span><span id="recordingDaysText">22</span> días grabación</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="hard-drive" class="w-4 h-4 text-gray-500"></i>
                        <span>Disco <span id="diskSizeText">4TB</span></span>
                    </div>
                </div>
            </div>

            <!-- Desglose de Precios -->
            <div class="bg-white border rounded-lg p-4 mb-2">
                <!-- <h3 class="text-lg font-semibold mb-4">Desglose de Precios</h3> -->
                <div class="space-y-3">
                    <!-- <div class="flex justify-between">
                        <span>Costo de Cámaras y Disco Duro:</span>
                        <span class="font-medium" id="camerasAndDiskCost">$26,964.39</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Costo de Cableado:</span>
                        <span class="font-medium" id="cablingCost">$9,600.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Costo de Instalación por Altura:</span>
                        <span class="font-medium" id="installationCost">$1,600.00</span>
                    </div>
                    <hr class="my-3"> -->
                    <div class="flex justify-between font-bold text-2xl">
                        <span>Total:</span>
                        <span class="text-blue-600" id="finalTotal">$38,164.39 MXM</span>
                    </div>
                </div>
            </div>

            <!-- Botones de Acción -->
            <div class="flex gap-3">
                <button onclick="openContactModal()"
                    class="flex-1 border border-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-50 transition-colors duration-200">
                    ¿No es lo que buscas?
                </button>
                <button onclick="openOrderModal()"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200">
                    Confirmar Pedido
                </button>
            </div>
        </div>
    </div>

    <div id="contactModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-60">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 mb-4">
                        <i data-lucide="help-circle" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">¿Necesitas algo diferente?</h3>
                    <p class="text-gray-600 text-sm">
                        No te preocupes, nuestro equipo puede ayudarte a encontrar la solución perfecta para tus
                        necesidades
                        específicas.
                    </p>
                </div>

                <div class="space-y-4">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-gray-900 mb-2">¿Qué puedes hacer?</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• Solicitar una cotización personalizada</li>
                            <li>• Hablar con un especialista</li>
                            <li>• Explorar otras opciones de seguridad</li>
                            <li>• Obtener asesoría técnica gratuita</li>
                        </ul>
                    </div>

                    <div class="flex gap-3">
                        <button onclick="closeContactModal()"
                            class="flex-1 border border-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="redirectToContact()"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                            Ir a Contacto
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-60">
        <div class="bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-green-100 mb-4">
                        <i data-lucide="shopping-cart" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Confirmar Pedido</h3>
                    <p class="text-gray-600 text-sm">
                        Completa tus datos para procesar tu pedido de sistema de cámaras
                    </p>
                </div>

                <!-- Formulario -->
                <form id="orderForm" class="space-y-4">
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">
                            Nombre completo *
                        </label>
                        <input type="text" id="customerName" name="customerName" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Ingresa tu nombre completo">
                    </div>

                    <div>
                        <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">
                            Correo electrónico *
                        </label>
                        <input type="email" id="customerEmail" name="customerEmail" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="ejemplo@correo.com">
                    </div>

                    <div>
                        <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">
                            Teléfono *
                        </label>
                        <input type="tel" id="customerPhone" name="customerPhone" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="241 244 12 12">
                    </div>

                    <div>
                        <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-1">
                            Dirección de instalación *
                        </label>
                        <textarea id="customerAddress" name="customerAddress" required rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Ingresa la dirección completa donde se instalará el sistema"></textarea>
                    </div>

                    <!-- Resumen del pedido -->
                    <div class="bg-gray-50 rounded-lg p-4 mt-6">
                        <h4 class="font-medium text-gray-900 mb-2">Resumen del pedido</h4>
                        <div class="text-sm text-gray-600 space-y-1">
                            <div class="flex justify-between">
                                <span>Sistema de cámaras:</span>
                                <span id="orderSummarySystem">16 cámaras 8MP</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Instalación:</span>
                                <span id="orderSummaryInstallation">Exterior</span>
                            </div>
                            <div class="flex justify-between font-medium text-gray-900 pt-2 border-t">
                                <span>Total:</span>
                                <span id="orderSummaryTotal">$38,164.39 USD</span>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeOrderModal()"
                            class="flex-1 border border-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="submitOrderBtn"
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                            Enviar Pedido
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>




<script>
    function openContactModal() {
        document.getElementById('contactModal').classList.remove('hidden');
        document.getElementById('contactModal').classList.add('flex');
    }

    function closeContactModal() {
        document.getElementById('contactModal').classList.add('hidden');
        document.getElementById('contactModal').classList.remove('flex');
    }

    function redirectToContact() {
        // Cambia esta URL por la ruta de tu formulario de contacto
        window.location.href = '/contacto';
    }


    function openOrderModal() {
        // Actualizar resumen del pedido antes de abrir
        updateOrderSummary();
        document.getElementById('orderModal').classList.remove('hidden');
        document.getElementById('orderModal').classList.add('flex');
    }

    function closeOrderModal() {
        document.getElementById('orderModal').classList.add('hidden');
        document.getElementById('orderModal').classList.remove('flex');
        // Limpiar formulario
        document.getElementById('orderForm').reset();
    }

    function updateOrderSummary() {
        // Obtener datos actuales del modal principal
        const quantity = document.getElementById('modalQuantity').textContent;
        const resolution = document.getElementById('modalResolution').textContent;
        const location = document.getElementById('modalLocation').textContent;
        const total = document.getElementById('finalTotal').textContent;

        // Actualizar resumen en el modal de pedido
        document.getElementById('orderSummarySystem').textContent = `${quantity} cámaras ${resolution}`;
        document.getElementById('orderSummaryInstallation').textContent = location;
        document.getElementById('orderSummaryTotal').textContent = total;
    }

    // Manejar envío del formulario de pedido
    document.getElementById('orderForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitBtn = document.getElementById('submitOrderBtn');
        const originalText = submitBtn.innerHTML;

        // Mostrar loading
        submitBtn.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>Enviando...';
        submitBtn.disabled = true;

        try {
            // Recopilar datos del formulario
            const formData = {
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerAddress: document.getElementById('customerAddress').value,
                // Agregar más datos de cotización si es necesario
                data: {
                    totalPrice: responseApi['Precio estimado'],
                    hdd: responseApi['Tamaño disco duro'],
                    cameras: document.getElementById('modalQuantity').textContent + " cámaras de " + document.getElementById('modalResolution').textContent,
                    wire: document.getElementById('cableDistance').textContent,
                    height: document.getElementById('summaryHeightText').textContent,
                    location: document.getElementById('modalLocation').textContent,
                    recordingDays: document.getElementById('modalRecordingDays').textContent,
                }

            };


            // Aquí harías la llamada a tu API
            const response = await fetch('/camaras/guardar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (response.ok) {
                // Éxito
                Swal.fire({
                    title: '¡Pedido Enviado!',
                    text: result.successMessage || 'Tu pedido ha sido enviado correctamente. Nos pondremos en contacto contigo pronto.',
                    icon: 'success',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#16a34a'
                }).then(() => {
                    closeOrderModal();
                    closeQuotationModal();
                });
            } else {
                const errorMessages = result.messages?.join('\n') || result.message || 'Error al enviar el pedido';

                Swal.fire({
                    title: 'Error',
                    icon: 'error',
                    html: `<ul style="text-align:left;">${result.messages?.map(msg => `<li>${msg}</li>`).join('') || errorMessages}</ul>`,
                    confirmButtonText: 'Revisar',
                    confirmButtonColor: '#dc2626'
                });
            }

        } catch (error) {
            console.error('Error al enviar pedido:', error);
            Swal.fire({
                title: 'Error',
                text: 'Hubo un problema al enviar tu pedido. Por favor, inténtalo de nuevo.',
                icon: 'error',
                confirmButtonText: 'Entendido',
                confirmButtonColor: '#dc2626'
            });
        } finally {
            // Restaurar botón
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });

    // Cerrar modales al hacer clic fuera
    document.getElementById('contactModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeContactModal();
        }
    });

    document.getElementById('orderModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeOrderModal();
        }
    });

    // Cerrar modales con tecla Escape
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            if (!document.getElementById('contactModal').classList.contains('hidden')) {
                closeContactModal();
            }
            if (!document.getElementById('orderModal').classList.contains('hidden')) {
                closeOrderModal();
            }
        }
    });
</script>